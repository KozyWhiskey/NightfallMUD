// NightfallMUD/server/prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Account {
  id         String      @id @default(cuid())
  username   String      @unique
  password   String
  characters Character[]
}

// In prisma/schema.prisma

model Character {
  id            String @id @default(cuid())
  name          String @unique

  accountId     String
  account       Account @relation(fields: [accountId], references: [id])

  level         Int    @default(1)
  experience    Int    @default(0)
  gold          Int    @default(10)

  // Core Attributes
  strength      Int    @default(5)
  dexterity     Int    @default(5)
  constitution  Int    @default(5)
  intelligence  Int    @default(5)
  wisdom        Int    @default(5)
  charisma      Int    @default(5)

  // Vitals
  hp            Int    @default(10)
  maxHp         Int    @default(10)
  mana          Int    @default(5)
  maxMana       Int    @default(5)
  defense       Int    @default(1) // <-- ADD THIS LINE

  // Game State
  currentRoomId String
  room          Room    @relation("RoomToCharacters", fields: [currentRoomId], references: [id])
  inventory     Item[]  @relation("CharacterToItems")
}

model Room {
  id          String   @id
  name        String
  description String
  exits       Json
  characters  Character[] @relation("RoomToCharacters")
  items       Item[]      @relation("RoomToItems")

  // --- NEW RELATION ---
  // A Room can have many Mobs
  mobs        Mob[]       @relation("RoomToMobs")
}

model Item {
  id          String     @id @default(cuid())
  name        String
  description String
  roomId      String?
  room        Room?      @relation("RoomToItems", fields: [roomId], references: [id])
  characterId String?
  character   Character? @relation("CharacterToItems", fields: [characterId], references: [id])
}

// --- NEW MODEL ---
// Defines a Mob (monster/NPC) in the game
model Mob {
  id                String  @id @default(cuid())
  name              String
  description       String

  // Stats
  level             Int     @default(1)
  hp                Int
  maxHp             Int
  strength          Int
  defense           Int

  // Rewards
  experienceAward   Int
  goldAward         Int

  // Location
  roomId            String
  room              Room    @relation("RoomToMobs", fields: [roomId], references: [id])
}